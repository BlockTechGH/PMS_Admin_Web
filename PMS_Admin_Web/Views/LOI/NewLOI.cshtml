@model PMS_Admin_Web.Models.LOI.NewLOIModel

@{
    ViewData["Title"] = "New LOI";
}

@if (ViewBag.Message != null)
{
    <script type="text/javascript">
        window.onload = function () {
            alert("@ViewBag.Message");
            window.location.href = "@Url.Action("ListLOI", "LOI")";
        };
    </script>
}

@*<div class="row">*@
<div class="col-lg-12">
    @*@Html.Raw(@ViewBag.Alert)*@

    <form asp-controller="LOI" asp-action="NewLOI" method="post" enctype="multipart/form-data">
        @Html.HiddenFor(model => model.LOI.Id)

        <div class="card" style="color:burlywood">
            <div class="card-header" style="background-color: darksalmon;">
                <h5 class="text-center" style="color:black"><strong>New LOI</strong></h5>
            </div>
            <br />
            <div class="col-lg-12">
                <div class="row">
                    <div class="col-lg-3">
                        <div class="form-group">
                            <label class="control-label text-black-50">LOI No</label>
                            <input asp-for="LOI.LoiNo1" class="form-control" type="text" style="border-radius: 10px;" />

                        </div>
                    </div>
                    <div class="col-lg-3">
                        <div class="form-group">
                            <label class="control-label text-black-50">Date</label>
                            <input readonly asp-for="LOI.LoiDate" value="@DateTime.Now.ToShortDateString()" class="form-control" type="text" style="border-radius: 10px;" />

                        </div>
                    </div>
                    <div class="col-lg-3">
                        <div class="form-group">
                            <label class="control-label text-black-50">Status</label>
                            <input readonly asp-for="LOI.LoiStatus" value="Open" class="form-control" type="text" style="border-radius: 10px;" />

                        </div>
                    </div>
                </div>
            </div>
            <div class="card-body">
                <ul class="nav nav-tabs" role="tablist">
                    <li class="nav-item">
                        <a class="nav-link active" data-toggle="tab" href="#ClientAndPropertyDetails">Client and Property Details</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-toggle="tab" href="#AgreementPeriodType">Agreement Period/Type</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-toggle="tab" href="#PaymentDetails">Payment Details</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-toggle="tab" href="#DocumentsSubmitted">Documents Submitted</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-toggle="tab" href="#OtherDetails">Other Details</a>
                    </li>
                </ul>
                <div class="tab-content">
                    <div class="tab-pane active" id="ClientAndPropertyDetails">
                        <div class="col-lg-12">
                            <br />
                            <div class="row">
                                <div class="col-lg-3">
                                    <div class="form-group">
                                        <label class="control-label text-black-50">Client Name</label>
                                        <input asp-for="LOI.ClientName" class="form-control" type="text" style="border-radius: 10px;" />
                                        <span asp-validation-for="LOI.ClientName" class="text-danger"></span>
                                    </div>
                                </div>
                                <div class="col-lg-3">
                                    <div class="form-group">
                                        <label class="control-label text-black-50">Company Name</label>
                                        <input asp-for="LOI.ClientCompany" class="form-control" type="text" style="border-radius: 10px;" />
                                        <span asp-validation-for="LOI.ClientCompany" class="text-danger"></span>
                                    </div>
                                </div>
                                <div class="col-lg-3">
                                    <div class="form-group">
                                        <label class="control-label text-black-50">Contact No</label>
                                        <input asp-for="LOI.Cmob" class="form-control" type="text" style="border-radius: 10px;" />
                                        <span asp-validation-for="LOI.Cmob" class="text-danger"></span>
                                    </div>
                                </div>
                                <div class="col-lg-3">
                                    <div class="form-group">
                                        <label class="control-label text-black-50">Nationality</label>
                                        <select id="nationality" asp-for="LOI.Cnationality" class="form-control" style="border-radius: 10px;">
                                            <option hidden value="">--Select--</option>
                                            @*@foreach (var area in Model.Nationalities)
                                {
                                    <option>@area.Nationalityname</option>
                                }*@
                                        </select>
                                        <span asp-validation-for="LOI.Cnationality" class="text-danger"></span>
                                    </div>
                                </div>
                                <div class="col-lg-3">
                                    <div class="form-group">
                                        <label class="control-label text-black-50">Client Source</label>
                                        <input asp-for="LOI.ClientSource" class="form-control" type="text" style="border-radius: 10px;" />
                                        <span asp-validation-for="LOI.ClientSource" class="text-danger"></span>
                                    </div>
                                </div>

                                <div class="col-lg-3">
                                    <div class="form-group">
                                        <label class="control-label text-black-50">Bedroom Requirement</label>
                                        <select asp-for="LOI.Req" class="form-control" style="border-radius: 10px;">
                                            <option value="">--Select--</option>
                                            <option value="1">1</option>
                                            <option value="2">2</option>
                                            <option value="3">3</option>
                                            <option value="4">4</option>
                                            <option value="5">5</option>
                                            <option value="6">6</option>
                                            <option value="7">7</option>
                                            <option value="8">8</option>
                                            <option value="Mulhaq">Mulhaq</option>
                                            <option value="Basement">Basement</option>
                                            <option value="Shop">Shop</option>
                                            @*<option value="RT">RT</option>*@
                                        </select>
                                        <span asp-validation-for="LOI.Req" class="text-danger"></span>
                                    </div>
                                </div>
                                <div class="col-lg-3">
                                    <div class="form-group">
                                        <label class="control-label text-black-50">Furnished</label>
                                        <select asp-for="LOI.Fur" class="form-control" style="border-radius: 10px;">
                                            <option value="">--Select--</option>
                                            <option value="SF">SF</option>
                                            <option value="FF">FF</option>
                                            <option value="UF">UF</option>
                                        </select>
                                        <span asp-validation-for="LOI.Fur" class="text-danger"></span>
                                    </div>
                                </div>
                            </div>

                            <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
                            <script>
                                        function loadNationality() {
                                            $.ajax({
                                                type:"GET",
                                                url:"@Url.Action("LoadNationality", "Common")",
                                                dataType: "json",
                                                success: function (response) {
                                                    $.each(response, function (k, v) {
                                                        $('#nationality').append('<option value="' + v + '" > ' + v + '</option>');
                                                    });
                                                }
                                            })
                                        }

                                        $(document).ready(function () {
                                            loadNationality();

                                            $("#propertysource").change(function () {

                                                var psource = $('#propertysource :selected').val();
                                                $.ajax({
                                                    type: "POST",
                                                    url: "@Url.Action("LoadProperties", "LOI")",
                                                    data: { propertysource: psource },
                                                    dataType: "json",
                                                    success: function (response) {
                                                        //alert(response)
                                                        $('#propertyname').html('');
                                                        $('#propertyname').append('<option value="" hidden> --Select-- </option>');
                                                        $('#aptno').html('');
                                                        $('#aptno').append('<option value="" hidden> --Select-- </option>');
                                                        $('#refno').val('');
                                                        $.each(response, function (k, v) {
                                                            $('#propertyname').append('<option value="' + v + '" > ' + v + '</option>');
                                                        });

                                                    }
                                                })

                                            });

                                            $("#propertyname").change(function () {

                                                var pname = $('#propertyname :selected').val();
                                                $.ajax({
                                                    type: "POST",
                                                    url: "@Url.Action("LoadApartmentNo", "LOI")",
                                                    data: { propertyname: pname },
                                                    dataType: "json",
                                                    success: function (response) {
                                                        //alert(response)
                                                        $('#aptno').html('');
                                                        $('#aptno').append('<option value="" hidden> --Select-- </option>');
                                                        $('#refno').val('');
                                                        $.each(response, function (k, v) {
                                                            $('#aptno').append('<option value="' + v + '" > ' + v + '</option>');
                                                        });

                                                    }
                                                })

                                            });
                                            var gRefsample = [];
                                            $("#aptno").change(function () {

                                                var pname = $('#propertyname :selected').val();
                                                var ano = $('#aptno :selected').last().val();
                                                var multipleApt = $('#multipleApt').prop('checked');
                                                if (multipleApt) {
                                                    //var gAptsample = $(ano).toArray().map(item => item.text).join();
                                                    var gAptsample = $('#aptno option:selected').toArray().map(item => item.text).join();
                                                    $('#gaptno').val(gAptsample);
                                                }
                                                $.ajax({
                                                    type: "POST",
                                                    url: "@Url.Action("LoadRefNo", "LOI")",
                                                    data: { propertyname: pname, aptno: ano },
                                                    dataType: "json",
                                                    success: function (response) {

                                                        $('#refno').val(response);
                                                        var refno = response;

                                                        if (multipleApt) {
                                                            gRefsample.push(refno);
                                                            $('#grefno').val(gRefsample);
                                                        }
                                                    }
                                                })

                                            });
                                        });
                            </script>
                            <div class="row">
                                <div class="col-lg-3">
                                    <div class="form-group">
                                        <label class="control-label text-black-50">Property Source</label>
                                        <select id="propertysource" asp-for="LOI.PropertySource" class="form-control" style="border-radius: 10px;">
                                            <option value="" hidden>--Select--</option>
                                            <option value="ManagedProperty">Managed Property</option>
                                            <option value="StandAloneProperty">Standalone Property</option>
                                        </select>
                                        <span asp-validation-for="LOI.PropertySource" class="text-danger"></span>
                                    </div>
                                </div>
                                <div class="col-lg-3">
                                    <div class="form-group">
                                        <label class="control-label text-black-50">Property Name</label>
                                        <select id="propertyname" asp-for="LOI.PropertyName" class="form-control" style="border-radius: 10px;">
                                            @*<option value="" hidden>--Select--</option>*@
                                        </select>
                                        <span asp-validation-for="LOI.PropertyName" class="text-danger"></span>
                                    </div>
                                </div>
                                <div class="col-lg-3" style="margin-top: 38px;">
                                    <div class="form-group">
                                        <label class="control-label text-black-50"> Multiple Apartments</label>
                                        <input id="multipleApt" type="checkbox" asp-for="MultipleApartment" />
                                        <label class="control-label text-black-50" style="font-size: 13px;">Note: Kindly check this option if you have Multiple Apartments to reserve.</label>
                                    </div>
                                </div>
                                <div class="col-lg-3">
                                    <div class="form-group">
                                        <label class="control-label text-black-50">Apartment No</label>
                                        <select id="aptno" asp-for="LOI.Aptno" class="form-control" style="border-radius: 10px;">
                                            @*<option value="" hidden>--Select--</option>*@
                                        </select>
                                        <label class="control-label text-black-50" style="font-size: 13px;">Note: To select multiple apartments, press ctrl and click the Apt No.</label>
                                    </div>
                                </div>
                                <script>
                                    $(document).ready(function () {
                                        $('#gaptCol').hide();
                                        $('#grefCol').hide();
                                        $('#clearbuttonCol').hide();
                                        $('#aptno').prop('multiple', false);

                                        $('#multipleApt').change(function () {
                                            var multipleApt = $('#multipleApt').prop('checked');
                                            if (multipleApt) {
                                                $('#gaptCol').show();
                                                $('#grefCol').show();
                                                $('#clearbuttonCol').show();
                                                $('#refnoCol').hide();
                                                $('#aptno').prop('multiple', true);

                                            }
                                            else {
                                                $('#gaptCol').hide();
                                                $('#grefCol').hide();
                                                $('#clearbuttonCol').hide();
                                                $('#refnoCol').show();
                                                $('#aptno').prop('multiple', false);
                                            }
                                        })

                                        $('#clearButton').click(function () {
                                            location.reload();
                                        })

                                    })
                                </script>
                                <div id="gaptCol" class="col-lg-3">
                                    <div class="form-group">
                                        <label class="control-label text-black-50">Group Apartment</label>
                                        <input id="gaptno" readonly asp-for="GroupAptno" class="form-control" type="text" style="border-radius: 10px;" />
                                        @*<span asp-validation-for="LcInfo.Pref" class="text-danger"></span>*@
                                    </div>
                                </div>
                                <div class="col-lg-3">
                                    <div class="form-group">
                                        <label class="control-label text-black-50">Reference No</label>
                                        <input readonly id="refno" asp-for="LOI.PropertyRefNo" class="form-control" type="text" style="border-radius: 10px;" />
                                        <span asp-validation-for="LOI.PropertyRefNo" class="text-danger"></span>
                                    </div>
                                </div>
                                <div id="clearbuttonCol" class="col-lg-3" style="margin-top: 30px;">
                                    <div class="form-group">
                                        <button id="clearButton" type="button" class="btn btn-primary" style="border-radius: 10px;">Clear</button>
                                    </div>
                                </div>
                                <div id="grefCol" class="col-lg-3">
                                    <div class="form-group">
                                        <label class="control-label text-black-50">Group Reference No</label>
                                        <input id="grefno" readonly asp-for="GroupPref" class="form-control" type="text" style="border-radius: 10px;" />
                                        @*<span asp-validation-for="LcInfo.Pref" class="text-danger"></span>*@
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <script>
                        $(document).ready(function () {
                            function converttoDay() {
                                var ymd = $('#YMD :selected').val();
                                var noofYMD = $('#NoYMD :selected').val();
                                var startDate = $('#leasestartDate').val();
                                var times = parseInt(noofYMD, 10);
                                //alert(startDate);

                                $.ajax({
                                    type: "POST",
                                    url: "@Url.Action("LoadLeaseEndDate", "LC")",
                                    data: { startDate: startDate, count: times, periodName: ymd },
                                    //dataType: "json",
                                    success: function (response) {
                                        //alert(response)
                                        $('#leaseendDate').val(response);
                                    },
                                    error: function (errResponse) {
                                        alert(errResponse)
                                    }
                                })
                            }

                            $("#NoYMD").change(function () {
                                converttoDay();
                            });

                            $('#leasestartDate').change(function () {
                                converttoDay()
                            })

                            $("#YMD").change(function () {
                                $('#NoYMD').html('');
                                $('#NoYMD').append('<option value="" hidden> --Select-- </option>');
                                var str = $('#YMD :selected').val();
                                if (str == "Year") {
                                    for (var i = 1; i <= 10; i++) {
                                        $('#NoYMD').append('<option value="' + i + '" > ' + i + '</option>');
                                    }
                                }
                                else if (str == "Month") {
                                    for (var i = 1; i <= 12; i++) {
                                        $('#NoYMD').append('<option value="' + i + '" > ' + i + '</option>');
                                    }
                                }
                                else {
                                    for (var i = 1; i <= 30; i++) {
                                        $('#NoYMD').append('<option value="' + i + '" > ' + i + '</option>');
                                    }
                                }
                            });
                        });
                    </script>
                    <div class="tab-pane" id="AgreementPeriodType">
                        <div class="col-lg-12">
                            <br />
                            <div class="row">
                                <div class="col-lg-3">
                                    <div class="form-group">
                                        <label class="control-label text-black-50">Lease Start Date</label>
                                        <input id="leasestartDate" asp-for="LOI.Leasedate" class="form-control" type="date" style="border-radius: 10px;" />
                                        <span asp-validation-for="LOI.Leasedate" class="text-danger"></span>
                                    </div>
                                </div>
                                <div class="col-lg-3">
                                    <div class="form-group">
                                        <label class="control-label text-black-50">Year/Month/Day</label>
                                        <select id="YMD" asp-for="LOI.Aptype" class="form-control" style="border-radius: 10px;">
                                            <option selected hidden>--Select--</option>
                                            <option value="Year">Year</option>
                                            <option value="Month">Month</option>
                                            <option value="Day">Day</option>
                                        </select>
                                        <span asp-validation-for="LOI.Aptype" class="text-danger"></span>
                                    </div>
                                </div>
                                <div class="col-lg-3">
                                    <div class="form-group">
                                        <label class="control-label text-black-50">No Of Year/Month/Day</label>
                                        <select id="NoYMD" asp-for="LOI.Ap" class="form-control" style="border-radius: 10px;">
                                        </select>
                                        <span asp-validation-for="LOI.Ap" class="text-danger"></span>
                                    </div>
                                </div>
                                <div class="col-lg-3">
                                    <div class="form-group">
                                        <label class="control-label text-black-50">Lease End Date</label>
                                        <input id="leaseendDate" asp-for="LOI.Leaseenddate" class="form-control" type="date" style="border-radius: 10px;" />
                                        <span asp-validation-for="LOI.Leaseenddate" class="text-danger"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <script>
                        $(document).ready(function () {

                            $("#lcrent").change(function () {
                                $('#deposit').html('');
                                $('#clientresf').html('');
                                $('#aptrent').html('');


                                var lcrent = $('#lcrent').val();
                                $('#deposit').val(lcrent);
                                var clientresf = lcrent / 2;
                                $('#clientresf').val(clientresf);
                                $('#aptrent').val(lcrent);
                            });
                        });
                    </script>
                    <div class="tab-pane" id="PaymentDetails">
                        <div class="col-lg-12">
                            <br />
                            <div class="row">
                                <div class="col-lg-3">
                                    <div class="form-group">
                                        <label class="control-label text-black-50">LC Rent</label>
                                        <input id="lcrent" asp-for="LOI.Rent" class="form-control" type="text" style="border-radius: 10px;" />
                                        <span asp-validation-for="LOI.Rent" class="text-danger"></span>
                                    </div>
                                </div>
                                <div class="col-lg-3">
                                    <div class="form-group">
                                        <label class="control-label text-black-50">Deposit</label>
                                        <input id="deposit" asp-for="LOI.Deposit" class="form-control" type="text" style="border-radius: 10px;" />
                                        <span asp-validation-for="LOI.Deposit" class="text-danger"></span>
                                    </div>
                                </div>
                                <div class="col-lg-3">
                                    <div class="form-group">
                                        <label class="control-label text-black-50">Client RESF</label>
                                        <input id="clientresf" asp-for="LOI.ClientResf" class="form-control" type="text" style="border-radius: 10px;" />
                                        <span asp-validation-for="LOI.ClientResf" class="text-danger"></span>
                                    </div>
                                </div>
                                <div class="col-lg-3">
                                    <div class="form-group">
                                        <label class="control-label text-black-50">LL RESF</label>
                                        <input asp-for="LOI.Llresf" class="form-control" type="text" style="border-radius: 10px;" />
                                        <span asp-validation-for="LOI.Llresf" class="text-danger"></span>
                                    </div>
                                </div>
                                <div class="col-lg-3">
                                    <div class="form-group">
                                        <label class="control-label text-black-50">Apt Rent</label>
                                        <input id="aptrent" asp-for="AptRent" class="form-control" type="text" style="border-radius: 10px;" />@*asp-for="LOI."*@
                                        @*<span asp-validation-for="LOI.Leaseenddate" class="text-danger"></span>*@
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane" id="DocumentsSubmitted">
                        <div class="col-lg-12">
                            <br />
                            <div class="row">
                                <div class="col-lg-4">
                                    <div class="form-group">
                                        <label class="control-label text-black-50">Passport(PP)</label>
                                        <input id="passport" type="file" name="passportfile"/>
                                    </div>
                                </div>
                                <div class="col-lg-4">
                                    <div class="form-group">
                                        <label class="control-label text-black-50">Civil ID(CID)</label>
                                        <input type="file" name="civilidfile"/>
                                    </div>
                                </div>
                                <div class="col-lg-4">
                                    <div class="form-group">
                                        <label class="control-label text-black-50">NOC Visa</label>
                                        <input type="file" name="nocvisafile"/>
                                    </div>
                                </div>
                                <div class="col-lg-4">
                                    <div class="form-group">
                                        <label class="control-label text-black-50">Marriage Contract</label>
                                        <input type="file" name="marriagecontractfile"/>
                                    </div>
                                </div>
                                <div class="col-lg-4">
                                    <div class="form-group">
                                        <label class="control-label text-black-50">MOC License/Itemmatokiya</label>
                                        <input type="file" name="moclicensefile"/>
                                    </div>
                                </div>
                                <div class="col-lg-4">
                                    <div class="form-group">
                                        <label class="control-label text-black-50">Civil ID of AS</label>
                                        <input type="file" name="civilidASfile"/>
                                    </div>
                                </div>
                                <div class="col-lg-4">
                                    <div class="form-group">
                                        <label class="control-label text-black-50">Cert of Employement/Salary Certificate</label>
                                        <input type="file" name="salarycertificatefile"/>
                                    </div>
                                </div>
                                <div class="col-lg-4">
                                    <div class="form-group">
                                        <label class="control-label text-black-50">Company Authorised Signatory</label>
                                        <input type="file" name="companysignfile"/>
                                    </div>
                                </div>
                                <div class="col-lg-4">
                                    <div class="form-group">
                                        <label class="control-label text-black-50">CID or PP copies of employee/staff</label>
                                        <input type="file" name="staffemployeefile"/>
                                    </div>
                                </div>
                                <div class="col-lg-4">
                                    <div class="form-group">
                                        <label class="control-label text-black-50">Company Guarantee</label>
                                        <input type="file" name="companyguaranteefile"/>
                                    </div>
                                </div>
                                <div class="col-lg-4">
                                    <div class="form-group">
                                        <label class="control-label text-black-50">LOI</label>
                                        <input type="file" name="loifile"/>
                                    </div>
                                </div>
                            </div>
                            <!--<div class="row">
                                <div class="col-lg-3">
                                    <div class="form-group">
                                        <label class="control-label text-black-50">File Upload</label>
                                        <input type="file" />-->@*asp-for="Property.Description"*@
                                    <!--</div>
                                </div>
                                <div class="col-lg-3">
                                    <button class="btn btn-primary" type="button" style="border-radius: 10px; margin-top: 25px;">Upload</button>
                                </div>
                            </div>-->
                        </div>
                    </div>
                    <div class="tab-pane" id="OtherDetails">
                        <div class="col-lg-12">
                            <br />
                            <div class="row">
                                <div class="col-lg-3">
                                    <div class="form-group">
                                        <label class="control-label text-black-50">LOI Approved</label>
                                        <input asp-for="LOI.Loisigndate" class="form-control" type="date" style="border-radius: 10px;" />
                                        <span asp-validation-for="LOI.Loisigndate" class="text-danger"></span>
                                    </div>
                                </div>
                                <div class="col-lg-3">
                                    <div class="form-group">
                                        <label class="control-label text-black-50">Move In Date</label>
                                        <input asp-for="LOI.Movingindate" class="form-control" type="date" style="border-radius: 10px;" />
                                        <span asp-validation-for="LOI.Movingindate" class="text-danger"></span>
                                    </div>
                                </div>

                                <div class="col-lg-6" style="margin-top: 40px;">
                                    <div class="row">
                                        <div class="col-lg-6">
                                            <div class="form-group">
                                                <label class="control-label text-black-50">Individual Client</label>
                                                <input type="radio" asp-for="LOI.EnquiryType" value="Individual Enquiry">
                                            </div>
                                        </div>
                                        <div class="col-lg-6">
                                            <div class="form-group">
                                                <label class="control-label text-black-50">Corporate Client</label>
                                                <input type="radio" asp-for="LOI.EnquiryType" value="Corporate Enquiry">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-6">
                                    <div class="form-group">
                                        <label class="control-label text-black-50">Remarks</label>
                                        @*<input asp-for="Property.Description" class="form-control" type="text" />*@
                                        <textarea asp-for="LOI.Loiremarks" class="form-control" style="width: 400px; border-radius: 10px;"></textarea>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="card" style="color:burlywood">
            <div class="card-body">
                <div class="col-lg-12">
                    <div class="form-group">
                        @*<button type="submit" class="btn btn-primary float-right" onclick="location.href='@Url.Action("NewLOI", "LOI",Model)'">Create</button>*@
                        <button type="submit" class="btn btn-primary float-right" style="border-radius:10px;">Create</button>
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>
@*</div>*@